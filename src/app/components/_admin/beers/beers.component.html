<div class="mt-4 mt-md-2 pr-3 pl-3 pb-3 pr-sm-0 pl-sm-0">
  <h3 class="heading">
    Beers ({{ beersService.beerCount() || 0 }})
    <button
        type="button"
        class="btn btn-sm btn-primary shadow-none m-0 ml-auto mr-2"
        (click)="showCreateBeerModal()">
        <i class="fa fa-plus mr-1"></i> Add New Beer</button>
  </h3>
  <div *ngIf="!beersService.isLoading; else showLoading">
    <ul
      class="list"
      *ngIf="beersService.beerCount()">
      <li
        app-beer-item
        class="list-item action-item pt-3 pb-3"
        [class.inactive]="!beer.value.isActive"
        [beer]="beer.value"
        (click)="showEditBeerModal(beer.value.id)"
        (removeBeer)="showRemoveBeerModal($event)"
        (restoreBeer)="restoreBeer($event)"
        *ngFor="let beer of beersService.beers | keyvalue"></li>
    </ul>
    <div *ngIf="!beersService.beerCount()">No Beers On Tap!</div>
  </div>
</div>

<!-- Loading -->
<ng-template #showLoading>
  <div class="loading-spinner mt-4">
    <i class="fa fa-refresh"></i>
  </div>
</ng-template>

<!-- Create / Edit Beer -->
<div [class.modal-open]="isCreateModalActive || isEditModalActive">
  <div
    class="modal fade"
    [class.show]="isCreateModalActive || isEditModalActive"
    id="editBeerModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="editBeerModal"
    aria-hidden="true">
    <div role="document" class="modal-dialog modal-notify">
      <div class="modal-content">
        <div class="modal-header modal-header-feature">
          <div class="avatar">
            <button
              class="btn btn-sm btn-light"
              (click)="changeImage($event)"
              *ngIf="!isImageUploadActive">
                {{ beersService.activeBeer.image ? 'Edit' : 'Add' }} Image
            </button>
            <input
              id="changeImage"
              type="file"
              (change)="uploadImage($event.target.files)" />
            <div
              class="progress-indicator"
              *ngIf="imageUploadPercentage | async as percent">
              <div
                class="progress"
                *ngIf="percent < 100">
                <div
                  class="progress-bar"
                  role="progressbar"
                  aria-valuenow="percent"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  [style.width]="percent + '%'"></div>
              </div>
              <span *ngIf="percent < 100">{{ percent | number: '1.0-0' }}%</span>
              <span
                class="text-success"
                *ngIf="isImageUploadActive && percent === 100">
                  <i class="fa fa-check-circle mr-1"></i> Ready
              </span>
            </div>
            <img [src]="beersService.activeBeer.image || '/assets/img/bottle.png'">
          </div>
          <h5
            class="modal-title"
            contenteditable="true"
            (blur)="setBeerTitle($event.target.textContent)">
            {{ beersService.activeBeer.title || 'Beer Title' }}
          </h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
            (click)="hideModals()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body pt-4 pr-4 pl-4 pb-0">
          <p
            class="pt-2 pb-3"
            contenteditable="true"
            (blur)="setBeerDescription($event.target.textContent)">
            {{ beersService.activeBeer.description || 'Beer Description' }}
          </p>
        </div>
        <div class="modal-footer p-2">
          <small
            class="d-none d-sm-inline ml-2 mr-auto text-light"
            *ngIf="isCreateModalActive">
            <strong>Click to make changes</strong>
          </small>
          <button
            type="button"
            class="btn btn-sm btn-grey mr-2"
            data-dismiss="modal"
            (click)="hideModals()">Cancel</button>
          <button
            type="button"
            *ngIf="isEditModalActive"
            (click)="editBeer()"
            class="btn btn-sm btn-success mr-2">Save</button>
            <!-- [disabled]="!beersForm.valid" -->
          <button
            type="button"
            *ngIf="!isEditModalActive"
            (click)="createBeer()"
            [disabled]="!beersService.activeBeer.title || !beersService.activeBeer.description"
            class="btn btn-sm btn-success">Create</button>
            <!-- [disabled]="!beersForm.valid" -->
        </div>
        <!-- <form [formGroup]="beersForm">
          <div class="modal-body pt-4 pr-4 pl-4 pb-0">
            <input
              type="text"
              name="title"
              class="form-control"
              [class.mb-4]="!formErrors.title"
              placeholder="Beer Title"
              formControlName="title">
            <div *ngIf="formErrors.title" class="text-danger p-2 pb-3">{{ formErrors.title }}</div>
            <textarea
              type="text"
              name="description"
              class="form-control"
              [class.mb-3]="!formErrors.description"
              placeholder="Beer Description"
              formControlName="description"></textarea>
            <div *ngIf="formErrors.description" class="text-danger p-2 pb-3">{{ formErrors.description }}</div>
            <div
              class="row align-items-center pr-2 pl-2 pb-3"
              *ngIf="beersService.activeBeer.isActive">
              <a
                href=""
                class="mr-auto ml-2"
                [class.disabled]="isImageUploadActive"
                (click)="changeImage($event)">Change Image</a>
              <input
                id="changeImage"
                type="file"
                (change)="uploadImage($event.target.files)" />
              <div
                class="progress-indicator ml-3 mr-2"
                *ngIf="imageUploadPercentage | async as percent">
                <div
                  class="progress w-100 ml-auto"
                  *ngIf="percent < 100">
                  <div
                    class="progress-bar"
                    role="progressbar"
                    aria-valuenow="percent"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    [style.width]="percent + '%'"></div>
                </div>
                <span
                  class="ml-2 mr-0"
                  *ngIf="percent < 100">
                  {{ percent | number: '1.0-0' }}%
                </span>
                <span
                  class="text-success mr-0 ml-auto"
                  *ngIf="isImageUploadActive && percent === 100">
                    <i class="fa fa-check-circle mr-2"></i> Upload Complete
                </span>
              </div>
            </div>
          </div>
        </form> -->
      </div>
    </div>
  </div>
</div>

<!-- Remove Beer -->
<div [class.modal-open]="isRemoveModalActive">
  <div
    class="modal fade"
    [class.show]="isRemoveModalActive"
    id="removeBeerModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="removeBeerModal"
    aria-hidden="true">
    <div role="document" class="modal-dialog modal-sm modal-notify modal-danger">
      <div class="modal-content text-center">
        <div class="modal-header d-flex justify-content-center">
          <p class="heading">Are you sure?</p>
        </div>
        <div class="modal-body">
          <i class="fa fa-times fa-4x animated rotateIn"></i>
        </div>
        <div class="modal-footer flex-center p-2">
          <button
            type="button"
            class="btn btn-sm btn-danger mr-2"
            (click)="removeBeer()">Yes</button>
          <button
            type="button"
            class="btn btn-sm btn-grey waves-effect"
            data-dismiss="modal"
            (click)="hideModals()">No</button>
        </div>
      </div>
    </div>
  </div>
</div>

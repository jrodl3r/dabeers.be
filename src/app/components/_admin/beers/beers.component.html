<div class="mt-4 mt-md-2 pr-3 pl-3 pb-3 pr-sm-0 pl-sm-0">
  <h3>
    Beers
    <button
        type="button"
        class="btn btn-sm btn-success shadow-none m-0 ml-auto mr-2"
        (click)="showCreateBeerModal()">
        <i class="fa fa-plus mr-1"></i> Add New Beer</button>
  </h3>
  <hr>
  <div *ngIf="!beersService.isLoading; else showLoading">
    <ul
      class="beers"
      *ngIf="beersService.beerCount()">
      <li
        app-beer-item
        class="mb-2 pt-2 pb-3"
        [class.inactive]="!beer.value.isActive"
        [beer]="beer.value"
        (editBeer)="showEditBeerModal($event)"
        (removeBeer)="showRemoveBeerModal($event)"
        (restoreBeer)="restoreBeer($event)"
        *ngFor="let beer of beersService.beers | keyvalue"></li>
    </ul>
    <div *ngIf="!beersService.beerCount()">No Beers On Tap!</div>
  </div>
</div>

<!-- Loading -->
<ng-template #showLoading>
  <div class="loading-spinner mt-4">
    <i class="fa fa-refresh"></i>
  </div>
</ng-template>

<!-- Modals -->
<div
  [class.modal-open]="isCreateModalActive || isEditModalActive || isRemoveModalActive"
  (click)="hideModals()">

  <!-- Create / Edit Beer -->
  <div
    class="modal fade"
    [class.show]="isCreateModalActive || isEditModalActive"
    id="editBeerModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="editBeerModal"
    aria-hidden="true">
    <div
      role="document"
      class="modal-dialog modal-notify"
      (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ isEditModalActive ? 'Edit' : 'Add New' }} Beer</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
            (click)="hideModals()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form [formGroup]="beersForm">
          <div class="modal-body pt-4 pr-4 pl-4 pb-0">
            <input
              type="text"
              name="title"
              class="form-control"
              [class.mb-4]="!formErrors.title"
              placeholder="Beer Title"
              formControlName="title">
            <div *ngIf="formErrors.title" class="text-danger p-2 pb-3">{{ formErrors.title }}</div>
            <textarea
              type="text"
              name="description"
              class="form-control"
              [class.mb-3]="!formErrors.description"
              placeholder="Beer Description"
              formControlName="description"></textarea>
            <div *ngIf="formErrors.description" class="text-danger p-2 pb-3">{{ formErrors.description }}</div>
            <div
              class="row align-items-center pr-2 pl-2 pb-3"
              *ngIf="beersService.activeBeer.isActive">
              <a
                href=""
                class="mr-auto ml-2"
                [class.disabled]="isImageUploadActive"
                (click)="changeImage($event)">Change Image</a>
              <input
                id="changeImage"
                type="file"
                (change)="uploadImage($event.target.files)" />
              <div
                class="progress-indicator ml-3 mr-2"
                *ngIf="imageUploadPercentage | async as percent">
                <div
                  class="progress w-100 ml-auto"
                  *ngIf="percent < 100">
                  <div
                    class="progress-bar"
                    role="progressbar"
                    aria-valuenow="percent"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    [style.width]="percent + '%'"></div>
                </div>
                <span
                  class="ml-2 mr-0"
                  *ngIf="percent < 100">
                  {{ percent | number: '1.0-0' }}%
                </span>
                <span
                  class="text-success mr-0 ml-auto"
                  *ngIf="isImageUploadActive && percent === 100">
                    <i class="fa fa-check-circle mr-2"></i> Upload Complete
                </span>
              </div>
            </div>
          </div>
          <div class="modal-footer p-2">
            <button
              type="button"
              class="btn btn-sm btn-grey mr-2"
              data-dismiss="modal"
              (click)="hideModals()">Cancel</button>
            <button
              type="button"
              *ngIf="isEditModalActive"
              (click)="editBeer()"
              [disabled]="!beersForm.valid"
              class="btn btn-sm btn-success mr-2">Save</button>
            <button
              type="button"
              *ngIf="!isEditModalActive"
              (click)="createBeer()"
              [disabled]="!beersForm.valid"
              class="btn btn-sm btn-success">Create</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Remove Beer -->
  <div
    class="modal fade"
    [class.show]="isRemoveModalActive && !isCreateModalActive && !isEditModalActive"
    id="removeBeerModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="removeBeerModal"
    aria-hidden="true">
    <div
      role="document"
      class="modal-dialog modal-sm modal-notify modal-danger"
      (click)="$event.stopPropagation()">
      <div class="modal-content text-center">
        <div class="modal-header d-flex justify-content-center">
          <p class="heading">Are you sure?</p>
        </div>
        <div class="modal-body">
          <i class="fa fa-times fa-4x animated rotateIn"></i>
        </div>
        <div class="modal-footer flex-center p-2">
          <button
            type="button"
            class="btn btn-sm btn-danger mr-2"
            (click)="removeBeer()">Yes</button>
          <button
            type="button"
            class="btn btn-sm btn-grey waves-effect"
            data-dismiss="modal"
            (click)="hideModals()">No</button>
        </div>
      </div>
    </div>
  </div>
</div>
